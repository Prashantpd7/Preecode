<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Preecode – Dashboard</title>
  <script src="/theme.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/tailwind-config.js"></script>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="bg-th-bg text-txt font-sans min-h-screen text-sm antialiased">

  <div class="app-shell min-h-screen relative z-10">
    <div class="app-main flex-1 flex flex-col">
      <div class="page-content flex-1 p-4 md:p-7 max-w-[1200px] w-full mx-auto opacity-0 animate-fade-in">

        <!-- ═══ Quick Actions Bar ═══ -->
        <div class="dash-quick-actions opacity-0 animate-fade-in-1">
          <a href="/pages/problems.html" class="dash-quick-btn">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
            Solve Problem
          </a>
          <a href="/pages/submissions.html" class="dash-quick-btn">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            View History
          </a>
          <a href="/pages/profile.html" class="dash-quick-btn">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0"/></svg>
            My Profile
          </a>
        </div>

        <!-- ═══ Hero: Continue Your Journey ═══ -->
        <div class="dash-hero opacity-0 animate-fade-in-1" id="dashHero" style="display:none">
          <p class="dash-hero-greeting" id="heroGreeting"></p>
          <p class="dash-hero-tagline" id="heroTagline"></p>
          <div class="dash-hero-badges">
            <span class="dash-hero-streak-pill" id="heroStreakPill">
              <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M12.832 3.56c.131-.19.334-.378.534-.358.178.018.42.261.482.452.236.719.237 1.5-.066 2.339a9.147 9.147 0 01-.397.85c-.122.226-.216.399-.238.442.032-.014.085-.021.151-.02.34.008.885.274 1.272.786a11.36 11.36 0 011.567 2.925c.46 1.267.555 2.626.076 3.86a5.85 5.85 0 01-2.234 2.817 5.847 5.847 0 01-3.242 1.198c-1.27.065-2.57-.235-3.645-.904a5.158 5.158 0 01-2.208-2.987c-.34-1.233-.205-2.523.174-3.678a10.56 10.56 0 011.454-2.83c.248-.346.513-.67.784-.975a.757.757 0 01.626-.274c.274.015.507.24.572.49.138.536.08 1.055-.018 1.442.482-.57.918-1.196 1.213-1.89.457-1.07.627-2.273.443-3.462-.092-.598-.162-.855-.324-1.223z"/></svg>
              <span id="heroStreakText">0 day streak</span>
            </span>
            <span class="dash-hero-level-pill" id="heroLevelPill">
              <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/></svg>
              <span id="heroLevelText">Level 1</span>
            </span>
          </div>
          <div class="dash-hero-progress">
            <div class="dash-hero-progress-track">
              <div class="dash-hero-progress-fill" id="heroProgressBar" style="width:0%"></div>
            </div>
            <p class="dash-hero-milestone" id="heroMilestone"></p>
          </div>
        </div>

        <!-- ═══ KPI Cards ═══ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-7 opacity-0 animate-fade-in-1" id="kpiGrid">

          <!-- Total Problems Solved -->
          <div class="dash-metric-card tint-blue">
            <div class="dash-accent-line"></div>
            <p class="dash-metric-label">Total Solved</p>
            <div class="flex items-baseline gap-2">
              <span class="dash-metric-value" id="statTotal">0</span>
              <span class="dash-metric-unit">problems</span>
            </div>
            <div class="dash-metric-trend up" id="totalTrend">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M7 17l4.2-4.2m0 0c.2-.2.5-.2.6 0l2.4 2.4m-3-2.4L17 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>+0 this week</span>
            </div>
            <svg class="dash-sparkline" viewBox="0 0 100 40" preserveAspectRatio="none"><polyline id="spark1" points="0,35 15,30 30,32 45,25 60,20 75,15 90,10 100,8" fill="none" stroke="var(--accent)" stroke-width="2"/></svg>
          </div>

          <!-- Accuracy -->
          <div class="dash-metric-card tint-green">
            <div class="dash-accent-line"></div>
            <p class="dash-metric-label">Accuracy Rate</p>
            <div class="flex items-baseline gap-1">
              <span class="dash-metric-value" id="accuracyRate">0</span>
              <span class="dash-metric-unit">%</span>
            </div>
            <div class="dash-metric-trend up" id="accuracyTrend">
              <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M7 17l4.2-4.2m0 0c.2-.2.5-.2.6 0l2.4 2.4m-3-2.4L17 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>+0% this week</span>
            </div>
            <svg class="dash-sparkline" viewBox="0 0 100 40" preserveAspectRatio="none"><polyline points="0,30 15,28 30,26 45,24 60,22 75,18 90,16 100,14" fill="none" stroke="var(--accent)" stroke-width="2"/></svg>
          </div>

          <!-- Average Solve Time -->
          <div class="dash-metric-card tint-purple">
            <div class="dash-accent-line"></div>
            <p class="dash-metric-label">Avg Solve Time</p>
            <div class="flex items-baseline gap-1">
              <span class="dash-metric-value" id="solveTimeAvg">0</span>
              <span class="dash-metric-unit">min</span>
            </div>
            <div class="dash-metric-trend" id="timeTrend">
              <span>Based on saved practice sessions</span>
            </div>
            <svg class="dash-sparkline" viewBox="0 0 100 40" preserveAspectRatio="none"><polyline points="0,10 15,14 30,12 45,18 60,22 75,26 90,30 100,32" fill="none" stroke="var(--accent)" stroke-width="2"/></svg>
          </div>

          <!-- Placement Readiness -->
          <div class="dash-metric-card tint-orange">
            <div class="dash-accent-line"></div>
            <p class="dash-metric-label">Placement Readiness</p>
            <div class="flex items-baseline gap-1">
              <span class="dash-metric-value dash-metric-accent" id="readinessScore">0</span>
              <span class="dash-metric-unit">/100</span>
            </div>
            <div class="mt-3 h-2 rounded-full overflow-hidden" style="background:var(--border-subtle)">
              <div class="h-full rounded-full transition-all duration-1000 ease-out" id="readinessBar" style="width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-hover))"></div>
            </div>
          </div>

        </div>

        <!-- ═══ Level / XP + Streak Row ═══ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-7 opacity-0 animate-fade-in-2">
          <!-- Level / XP -->
          <div class="app-card dash-level-card p-5">
            <div class="flex items-center gap-3">
              <div class="rank-icon" id="dashRankIcon">1</div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-bold text-txt" id="dashRankName">Level 1 &mdash; Beginner</p>
                <p class="text-[11px] text-txt-faint" id="dashRankXP">0 / 50 XP</p>
              </div>
            </div>
            <div class="rank-progress-track mt-3">
              <div class="rank-progress-fill" id="dashRankBar" style="width:0%"></div>
            </div>
          </div>
          <!-- Streak -->
          <div class="app-card dash-streak-card p-5">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="dash-streak-icon" id="dashStreakFlame">
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12.832 3.56c.131-.19.334-.378.534-.358.178.018.42.261.482.452.236.719.237 1.5-.066 2.339a9.147 9.147 0 01-.397.85c-.122.226-.216.399-.238.442.032-.014.085-.021.151-.02.34.008.885.274 1.272.786a11.36 11.36 0 011.567 2.925c.46 1.267.555 2.626.076 3.86a5.85 5.85 0 01-2.234 2.817 5.847 5.847 0 01-3.242 1.198c-1.27.065-2.57-.235-3.645-.904a5.158 5.158 0 01-2.208-2.987c-.34-1.233-.205-2.523.174-3.678a10.56 10.56 0 011.454-2.83c.248-.346.513-.67.784-.975a.757.757 0 01.626-.274c.274.015.507.24.572.49.138.536.08 1.055-.018 1.442.482-.57.918-1.196 1.213-1.89.457-1.07.627-2.273.443-3.462-.092-.598-.162-.855-.324-1.223z"/></svg>
                </div>
                <div>
                  <p class="text-sm font-bold text-txt" id="dashStreakLabel">0 Day Streak</p>
                  <p class="text-[11px] text-txt-faint" id="dashStreakMsg">Start solving to build a streak</p>
                </div>
              </div>
              <div class="dash-streak-badge" id="dashStreakBadge">0</div>
            </div>
          </div>
        </div>

        <!-- ═══ Middle: Weekly Performance + Weak Topics ═══ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-7 opacity-0 animate-fade-in-2">

          <!-- Weekly Performance -->
          <div class="app-card dash-chart-card p-6">
            <div class="flex items-center justify-between mb-2">
              <span class="dash-section-title">Weekly Performance</span>
              <span class="text-xs text-txt-muted" id="weekTotal">0 submissions</span>
            </div>
            <p class="text-xs text-txt-faint mb-4" id="weekSummary">No data yet</p>
            <div class="flex items-end gap-2" style="height:140px" id="activityBars">
              <!-- Skeleton bars while loading -->
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:40px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:65px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:35px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:80px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:50px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:70px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
              <div class="flex-1 flex flex-col items-center"><div class="skeleton skeleton-bar w-full max-w-[28px]" style="height:55px"></div><div class="skeleton mt-2" style="width:20px;height:8px"></div></div>
            </div>
          </div>

          <!-- Weak Topics -->
          <div class="app-card dash-chart-card p-6">
            <div class="flex items-center justify-between mb-2">
              <span class="dash-section-title">Weak Topics</span>
              <span class="text-xs text-txt-faint" id="weakTopicCount">0 topics flagged</span>
            </div>
            <p class="text-xs text-txt-faint mb-4" id="weakSummary">Focus on these areas to improve</p>
            <div class="flex flex-col gap-3" id="weakList">
              <div class="skeleton-row"><div class="skeleton skeleton-line" style="width:60%"></div><div class="skeleton" style="width:32px;height:12px"></div></div>
              <div class="skeleton-row"><div class="skeleton skeleton-line" style="width:45%"></div><div class="skeleton" style="width:32px;height:12px"></div></div>
              <div class="skeleton-row"><div class="skeleton skeleton-line" style="width:70%"></div><div class="skeleton" style="width:32px;height:12px"></div></div>
            </div>
          </div>

        </div>

        <!-- ═══ Mini Heatmap ═══ -->
        <div class="app-card p-6 mb-7 opacity-0 animate-fade-in-3">
          <div class="flex items-center justify-between mb-1">
            <span class="dash-section-title">Consistency Tracker</span>
            <span class="text-xs text-txt-faint">Last 7 days</span>
          </div>
          <p class="text-xs text-txt-faint mb-4" id="heatmapSummary">--</p>
          <div class="activity-heatmap" id="dashHeatmap">
            <!-- JS populates -->
          </div>
          <div class="flex items-center gap-2 mt-3">
            <span class="text-[10px] text-txt-faint">Less</span>
            <div class="flex gap-1">
              <div class="heatmap-legend-cell l0"></div>
              <div class="heatmap-legend-cell l1"></div>
              <div class="heatmap-legend-cell l2"></div>
              <div class="heatmap-legend-cell l3"></div>
              <div class="heatmap-legend-cell l4"></div>
            </div>
            <span class="text-[10px] text-txt-faint">More</span>
          </div>
        </div>

        <!-- ═══ Recent Submissions ═══ -->
        <div class="app-card dash-table-card p-5 mb-7 opacity-0 animate-fade-in-3">
          <div class="flex items-center justify-between mb-4">
            <span class="dash-section-title">Recent Submissions</span>
            <span class="dash-count-badge" id="subCount">0</span>
          </div>
          <div class="overflow-x-auto">
            <table class="app-table min-w-[560px]">
              <thead>
                <tr>
                  <th>Problem</th>
                  <th>Difficulty</th>
                  <th>Status</th>
                  <th>Time</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody id="submissionsBody">
                <tr><td colspan="5"><div class="skeleton-row"><div class="skeleton skeleton-line" style="width:40%"></div><div class="skeleton" style="width:50px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:60px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:40px;height:12px"></div><div class="skeleton" style="width:70px;height:12px"></div></div><div class="skeleton-row"><div class="skeleton skeleton-line" style="width:55%"></div><div class="skeleton" style="width:50px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:60px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:40px;height:12px"></div><div class="skeleton" style="width:70px;height:12px"></div></div><div class="skeleton-row"><div class="skeleton skeleton-line" style="width:35%"></div><div class="skeleton" style="width:50px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:60px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:40px;height:12px"></div><div class="skeleton" style="width:70px;height:12px"></div></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- ═══ Practice Sessions ═══ -->
        <div class="app-card dash-table-card p-5 opacity-0 animate-fade-in-4">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <span class="dash-section-title">Practice Sessions</span>
              <span class="dash-ext-badge">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"/></svg>
                VS Code
              </span>
            </div>
            <span class="dash-count-badge" id="practiceCount">0</span>
          </div>
          <div class="overflow-x-auto">
            <table class="app-table min-w-[560px]">
              <thead>
                <tr>
                  <th>Question</th>
                  <th>Language</th>
                  <th>Time Taken</th>
                  <th>Hints</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody id="practiceBody">
                <tr><td colspan="5"><div class="skeleton-row"><div class="skeleton skeleton-line" style="width:50%"></div><div class="skeleton" style="width:50px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:40px;height:12px"></div><div class="skeleton" style="width:20px;height:12px"></div><div class="skeleton" style="width:70px;height:12px"></div></div><div class="skeleton-row"><div class="skeleton skeleton-line" style="width:40%"></div><div class="skeleton" style="width:50px;height:20px;border-radius:6px"></div><div class="skeleton" style="width:40px;height:12px"></div><div class="skeleton" style="width:20px;height:12px"></div><div class="skeleton" style="width:70px;height:12px"></div></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script src="/api.js"></script>
  <script>
    // If OAuth redirected back with a token in querystring, persist it before layout runs
    (function () {
      try {
        var params = new URLSearchParams(window.location.search);
        var t = params.get('token');
        if (t) {
          localStorage.setItem('token', t);
          // remove token from URL
          params.delete('token');
          var newSearch = params.toString();
          var newUrl = window.location.pathname + (newSearch ? '?' + newSearch : '');
          history.replaceState({}, document.title, newUrl);
        }
      } catch (e) {
        // ignore
      }
    })();
  </script>
  <script src="/layout/layout.js"></script>
  <script src="/layout/chatbot.js"></script>
  <script src="/layout/early-access.js"></script>
  <script src="/pages/dashboard.js"></script>
</body>
</html>
